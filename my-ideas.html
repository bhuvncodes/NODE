<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Ideas - Student Idea Collaboration</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar Toggle Button (Fixed Position) -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="brand">
                <img src="node.png" alt="NodeLogo" class="node-logo">
            </div>
            <h2>NODE</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <span>üìä</span> Dashboard
            </a>
            <a href="my-ideas.html" class="nav-item active">
                <span>üí°</span> My Ideas
            </a>
            <a href="project-workspace.html" class="nav-item">
                <span>üöÄ</span> Projects
            </a>
            <a href="profile.html" class="nav-item">
                <span>üë§</span> Profile
            </a>
            <a href="index.html" class="nav-item">
                <span>üö™</span> Logout
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-header">
            <h1>My Ideas</h1>
            <div style="display: flex; gap: 10px;">
                <button class="btn-secondary" onclick="if(typeof loadMyIdeasPage === 'function') loadMyIdeasPage(); else alert('Function not loaded yet');">üîÑ Refresh</button>
                <button class="btn-primary" onclick="openModal('createIdeaModal')">+ Create New Idea</button>
            </div>
        </div>

        <!-- Ideas Grid -->
        <div class="ideas-grid" id="ideasGrid">
            <!-- Empty State -->
            <div class="empty-state-card" id="emptyIdeasState">
                <div class="empty-icon-large">üí°</div>
                <h3>No Ideas Yet</h3>
                <p>You haven't created any ideas yet. Start by posting your first idea!</p>
                <button class="btn-primary" onclick="openModal('createIdeaModal')">+ Create Your First Idea</button>
            </div>

            <!-- Ideas will be dynamically populated here by backend -->
            <!-- Example structure (for reference):
            <div class="card idea-card">
                <div class="idea-header">
                    <h3>Idea Title</h3>
                    <span class="status-badge status-open">Open</span>
                </div>
                <p class="idea-description">Idea description...</p>
                <div class="idea-tags">
                    <span class="tag">Tag1</span>
                    <span class="tag">Tag2</span>
                </div>
                <div class="idea-actions">
                    <button class="btn-secondary" onclick="viewIdea()">View</button>
                    <button class="btn-secondary" onclick="editIdea()">Edit</button>
                    <button class="btn-secondary" onclick="viewRequests()">Requests (0)</button>
                </div>
            </div>
            -->
        </div>
    </main>

    <!-- Create Idea Modal -->
    <div id="createIdeaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('createIdeaModal')">&times;</span>
            <h2>Create New Idea</h2>
            <form id="createIdeaForm" onsubmit="createIdea(event)">
                <input id="ideaTitle" type="text" placeholder="Project / Idea Title" required>
                <textarea id="ideaDescription" placeholder="Describe your project or idea" rows="5" required></textarea>
                
                <!-- Departments needed for this project -->
                <label><strong>Departments needed</strong></label>
                <div class="departments-checkbox-group" id="departmentsGroup">
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="CSE">
                        <span>CSE</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="ECE">
                        <span>ECE</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="MECH">
                        <span>MECH</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="CIVIL">
                        <span>CIVIL</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="BME">
                        <span>BME</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="CSM">
                        <span>CSM</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="ideaDepartments" value="CSD">
                        <span>CSD</span>
                    </label>
                </div>
                <small>Select one or more departments.</small>

                <!-- Total team size -->
                <label for="totalMembers"><strong>Total team size (members per team)</strong></label>
                <input id="totalMembers" type="number" min="1" placeholder="e.g., 4" required>

                <button type="submit" class="btn-primary">Create Idea</button>
            </form>
        </div>
    </div>

    <!-- Join Requests Modal -->
    <div id="joinRequestsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('joinRequestsModal')">&times;</span>
            <h2>Join Requests</h2>
            <p id="joinRequestsIdeaTitle" style="color: #666; margin-bottom: 12px;"></p>
            <div id="joinRequestsEmptyState" class="empty-state" style="display: none; padding: 20px 10px;">
                <div class="empty-icon">üì®</div>
                <h3>No Requests Yet</h3>
                <p>When students request to join, their details will appear here.</p>
            </div>
            <div id="joinRequestsList" class="roles-list" style="max-height: 400px; overflow-y: auto;">
                <!-- Requests will be injected here -->
            </div>
        </div>
    </div>

    <!-- Firebase Scripts for idea posting -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="app.js" onload="console.log('app.js loaded successfully')" onerror="console.error('Failed to load app.js')"></script>
    <script src="ui.js"></script>
    <script>
        // Wait for all scripts to load, then initialize
        (function() {
            let attempts = 0;
            const maxAttempts = 100; // 10 seconds max
            
            function tryInitialize() {
                attempts++;
                
                // Check if Firebase and required functions are available
                if (typeof firebase !== 'undefined' && 
                    typeof firebase.firestore !== 'undefined' &&
                    typeof loadMyIdeasPage === 'function') {
                    
                    console.log("All scripts loaded, initializing...");
                    
                    // Check authentication and load ideas
                    firebase.auth().onAuthStateChanged(function(user) {
                        if (user) {
                            console.log("User authenticated:", user.uid);
                            try {
                                loadMyIdeasPage();
                            } catch (e) {
                                console.error("Error calling loadMyIdeasPage:", e);
                                const emptyState = document.getElementById("emptyIdeasState");
                                if (emptyState) {
                                    emptyState.innerHTML = `
                                        <div class="empty-icon-large">‚ùå</div>
                                        <h3>Error Loading Ideas</h3>
                                        <p>${e.message}</p>
                                        <button class="btn-primary" onclick="window.location.reload()">Refresh Page</button>
                                    `;
                                    emptyState.style.display = "block";
                                }
                            }
                        } else {
                            alert("Please log in to view your ideas.");
                            window.location = "login.html";
                        }
                    });
                    
                    return; // Success, stop retrying
                }
                
                // If not ready and haven't exceeded max attempts, try again
                if (attempts < maxAttempts) {
                    setTimeout(tryInitialize, 100);
                } else {
                    // Max attempts reached
                    console.error("Failed to load scripts after " + maxAttempts + " attempts");
                    const emptyState = document.getElementById("emptyIdeasState");
                    if (emptyState) {
                        emptyState.innerHTML = `
                            <div class="empty-icon-large">‚ùå</div>
                            <h3>Script Loading Error</h3>
                            <p>Could not load required scripts. Please check:</p>
                            <ul style="text-align: left; max-width: 400px; margin: 10px auto;">
                                <li>Browser console for errors (F12)</li>
                                <li>Network tab to see if app.js loaded</li>
                                <li>Try refreshing the page</li>
                            </ul>
                            <button class="btn-primary" onclick="window.location.reload()">Refresh Page</button>
                        `;
                        emptyState.style.display = "block";
                    }
                }
            }
            
            // Start trying after a short delay to let scripts start loading
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(tryInitialize, 200);
                });
            } else {
                setTimeout(tryInitialize, 200);
            }
        })();
    </script>
</body>
</html>

